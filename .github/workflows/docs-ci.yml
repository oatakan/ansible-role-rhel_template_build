---
name: Docs CI

on:
  pull_request:
    branches: [main, master]
    # Only run for documentation changes
    paths:
      - '**.md'
      - 'docs/**'
      - 'CHANGELOG.md'

jobs:
  docs-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check markdown files
        run: |
          echo "🔍 Checking documentation files..."
          
          # Basic markdown linting
          echo "Checking for common markdown issues..."
          
          # Check for broken internal links (basic check)
          if command -v grep &> /dev/null; then
            echo "Checking for potential broken internal links..."
            find . -name "*.md" -exec grep -l "](\./" {} \; | while read file; do
              echo "Found internal links in: $file"
            done
          fi
          
          # Check for TODO/FIXME in docs
          if grep -r "TODO\|FIXME" . --include="*.md" | head -5; then
            echo "⚠️ Found TODO/FIXME items in documentation (review recommended)"
          fi
          
          echo "✅ Basic documentation checks completed"

      - name: Validate CHANGELOG format (if changed)
        if: contains(github.event.pull_request.changed_files, 'CHANGELOG.md')
        run: |
          echo "📋 Validating CHANGELOG.md format..."
          
          if [ -f CHANGELOG.md ]; then
            # Basic format check
            if head -n 1 CHANGELOG.md | grep -q "# Changelog\|# CHANGELOG"; then
              echo "✅ CHANGELOG.md has proper header"
            else
              echo "⚠️ CHANGELOG.md might be missing proper header"
            fi
          fi

      - name: Success summary
        run: |
          echo "### 📚 Documentation CI Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "✅ **Documentation checks passed**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- Basic markdown validation completed" >> $GITHUB_STEP_SUMMARY
          echo "- Internal link structure reviewed" >> $GITHUB_STEP_SUMMARY
          echo "- CHANGELOG format validated (if applicable)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "*This lightweight CI ensures documentation quality without running full test suites.*" >> $GITHUB_STEP_SUMMARY